<!DOCTYPE html>
<html lang="th" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memory of SWC 2568 | บันทึกความทรงจำ</title>
    <meta name="description" content="เว็บไซต์ปัจฉิมนิเทศโรงเรียนศรีวิชัยวิทยา รุ่นปี 2568">

    <!-- 1. Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=Anuphan:wght@300;400;600&family=Kodchasan:wght@500;700&family=Sarabun:wght@300;400;600&family=Charm:wght@700&display=swap"
        rel="stylesheet">

    <!-- 2. Configuration -->
    <script>
        const GAS_WEB_APP_URL = '';

        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'swc-dark': '#151719',
                        'swc-green': '#1f5731',
                        'swc-green-light': '#2d7a44',
                        'swc-gold': '#d4af37',
                        'swc-gold-hover': '#b5952f',
                        'swc-paper': '#fbf3e4',
                    },
                    fontFamily: {
                        'heading': ['Kodchasan', 'sans-serif'],
                        'body': ['Sarabun', 'sans-serif'],
                        'hand': ['Charm', 'cursive'],
                    },
                    animation: {
                        'spin-slow': 'spin 8s linear infinite',
                        'float': 'float 6s ease-in-out infinite',
                        'fade-in': 'fadeIn 2s ease-out forwards',
                        'shimmer': 'shimmer 1.5s infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0) translateX(0)' },
                            '50%': { transform: 'translateY(-20px) translateX(10px)' },
                        },
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        shimmer: {
                            '100%': { transform: 'translateX(100%)' },
                        }
                    }
                }
            }
        }
    </script>

    <!-- 3. Custom Styles -->
    <style>
        .film-grain {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 40;
            opacity: 0.04;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #151719;
        }

        ::-webkit-scrollbar-thumb {
            background: #1f5731;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #d4af37;
        }

        body {
            background-color: #151719;
            color: #fbf3e4;
            overflow-x: hidden;
        }

        .glass-panel {
            background: rgba(31, 87, 49, 0.15);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(212, 175, 55, 0.2);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }

        .nav-link {
            position: relative;
        }

        .nav-link::after {
            content: '';
            position: absolute;
            bottom: -4px;
            left: 0;
            width: 0%;
            height: 2px;
            background-color: #d4af37;
            border-radius: 2px;
            transition: width 0.3s ease-in-out;
        }

        .nav-active {
            color: #d4af37 !important;
        }

        .nav-active::after {
            width: 100%;
        }

        .typing-cursor::after {
            content: '|';
            animation: blink 1s step-end infinite;
            color: #d4af37;
        }

        @keyframes blink {
            50% {
                opacity: 0;
            }
        }

        .firefly {
            position: fixed;
            width: 4px;
            height: 4px;
            background-color: #d4af37;
            border-radius: 50%;
            box-shadow: 0 0 10px #d4af37, 0 0 20px #d4af37;
            opacity: 0;
            animation: firefly-move linear infinite;
            pointer-events: none;
            z-index: 1;
        }

        @keyframes fadeInSection {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .nav-locked {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .nav-unlocked-pulse {
            animation: navPulse 1.5s infinite;
            color: #d4af37 !important;
            text-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
        }

        @keyframes navPulse {
            0% {
                opacity: 1;
                text-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
            }

            50% {
                opacity: 0.6;
                text-shadow: 0 0 20px rgba(212, 175, 55, 0.8);
            }

            100% {
                opacity: 1;
                text-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
            }
        }

        @keyframes firefly-move {
            0% {
                opacity: 0;
                transform: translateY(100vh) scale(0);
            }

            10% {
                opacity: 1;
                transform: translateY(90vh) scale(1);
            }

            90% {
                opacity: 1;
                transform: translateY(10vh) scale(1);
            }

            100% {
                opacity: 0;
                transform: translateY(0) scale(0);
            }
        }

        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>

<body class="antialiased font-body relative">

    <div class="film-grain"></div>
    <div id="fireflies-container"></div>

    <!-- Music Audio (YouTube Hidden Player) -->
    <div id="youtube-audio" style="position: absolute; top: -9999px; left: -9999px; visibility: hidden;"></div>
    <script src="https://www.youtube.com/iframe_api"></script>

    <!-- Floating Music Control -->
    <div class="fixed bottom-6 left-6 z-50">
        <button id="music-btn" onclick="toggleMusic()"
            class="w-12 h-12 rounded-full bg-swc-dark border-2 border-swc-gold text-swc-gold shadow-[0_0_15px_rgba(212,175,55,0.3)] flex items-center justify-center hover:scale-110 transition-transform duration-300 group">
            <i id="music-icon" class="fas fa-play ml-1"></i>
            <div class="absolute left-14 bg-swc-dark/90 border border-swc-gold/30 px-3 py-1 rounded text-xs text-swc-gold whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none"
                id="music-tooltip">
                เล่นเพลงความทรงจำ
            </div>
        </button>
    </div>

    <button id="back-to-top" onclick="window.scrollTo({top: 0, behavior: 'smooth'})"
        class="fixed bottom-6 right-6 z-50 w-12 h-12 rounded-full bg-swc-green text-swc-paper shadow-lg transform translate-y-20 opacity-0 transition-all duration-300 hover:bg-swc-gold hover:text-swc-dark flex items-center justify-center hover:-translate-y-1">
        <i class="fas fa-arrow-up"></i>
    </button>

    <!-- Lightbox Modal -->
    <div id="lightbox" class="fixed inset-0 z-[10000] bg-black/95 hidden flex items-center justify-center p-4"
        onclick="closeLightbox()">
        <button class="absolute top-4 right-4 text-white/70 hover:text-swc-gold text-4xl font-heading"
            onclick="closeLightbox()">&times;</button>
        <img id="lightbox-img" src="" alt="Full Image"
            class="max-w-full max-h-[90vh] rounded-lg shadow-[0_0_50px_rgba(0,0,0,0.8)] border border-swc-gold/20 transform scale-90 transition-transform duration-300">
    </div>

    <!-- NAVIGATION -->
    <header
        class="sticky top-0 z-50 bg-swc-dark/80 backdrop-blur-lg border-b border-swc-gold/10 transition-all duration-300"
        id="main-header">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center cursor-pointer group" onclick="navigateTo('home')">
                    <div
                        class="w-10 h-10 rounded-full bg-gradient-to-tr from-swc-green to-swc-dark border border-swc-gold flex items-center justify-center mr-3 shadow-lg group-hover:scale-110 transition-transform">
                        <span class="font-heading font-bold text-swc-gold text-xs">SWC</span>
                    </div>
                    <span class="font-heading text-xl text-swc-gold tracking-wide hidden sm:block">Memory of SWC
                        2568<span class="text-swc-paper"></span></span>
                </div>

                <nav class="hidden md:flex space-x-8">
                    <a href="#home"
                        class="text-swc-paper/80 hover:text-swc-gold transition-colors font-medium text-sm uppercase tracking-wider py-1 nav-link nav-active"
                        onclick="navigateTo('home', event)">Home</a>

                    <a href="#vtr" id="nav-vtr"
                        class="text-swc-paper/80 hover:text-swc-gold transition-colors font-medium text-sm uppercase tracking-wider py-1 nav-link nav-locked"
                        onclick="navigateTo('vtr', event)">LOCK</a>

                    <a href="#guestbook"
                        class="text-swc-paper/80 hover:text-swc-gold transition-colors font-medium text-sm uppercase tracking-wider py-1 nav-link"
                        onclick="navigateTo('guestbook', event)">Guestbook</a>



                    <a href="#letters" id="nav-letters"
                        class="px-4 py-1 rounded-full border border-swc-gold text-swc-gold hover:bg-swc-gold hover:text-swc-dark transition-all text-sm font-bold uppercase tracking-wide nav-locked"
                        onclick="navigateTo('letters', event)">LOCK</a>
                </nav>

                <div class="md:hidden">
                    <button onclick="toggleMobileMenu()"
                        class="text-swc-gold focus:outline-none p-2 hover:bg-swc-green/20 rounded-lg transition-colors">
                        <i class="fas fa-bars text-2xl"></i>
                    </button>
                </div>
            </div>
        </div>

        <div id="mobile-menu"
            class="hidden md:hidden bg-swc-dark/95 backdrop-blur-xl border-t border-swc-gold/10 absolute w-full shadow-2xl transform origin-top transition-transform duration-300">
            <div class="px-4 pt-2 pb-6 space-y-2">
                <a href="#home" onclick="mobileNav('home')"
                    class="block px-3 py-3 rounded-md text-base font-medium text-swc-paper hover:bg-swc-green/20 hover:text-swc-gold border-l-4 border-transparent hover:border-swc-gold transition-all">Home</a>

                <a href="#vtr" onclick="mobileNav('vtr')"
                    class="block px-3 py-3 rounded-md text-base font-medium text-swc-paper hover:bg-swc-green/20 hover:text-swc-gold border-l-4 border-transparent hover:border-swc-gold transition-all">VTR
                    & Film</a>

                <a href="#guestbook" onclick="mobileNav('guestbook')"
                    class="block px-3 py-3 rounded-md text-base font-medium text-swc-paper hover:bg-swc-green/20 hover:text-swc-gold border-l-4 border-transparent hover:border-swc-gold transition-all">Guestbook</a>
                <a href="#letters" onclick="mobileNav('letters')"
                    class="block px-3 py-3 rounded-md text-base font-medium text-swc-gold bg-swc-green/10 border-l-4 border-swc-gold mt-2">เข้าสู่ระบบ
                    (Login)</a>
            </div>
        </div>
    </header>

    <!-- MAIN CONTENT -->
    <main class="pb-20">

        <!-- 1. HOME SECTION -->
        <section id="home" class="min-h-screen flex flex-col items-center justify-center relative pt-10 px-4">

            <div class="text-center space-y-8 max-w-5xl mx-auto z-10" data-aos="zoom-in" data-aos-duration="1200">
                <div
                    class="inline-block px-4 py-1 border border-swc-gold/30 rounded-full bg-swc-gold/5 mb-2 backdrop-blur-sm">
                    <span class="text-xs font-heading tracking-[0.2em] text-swc-gold uppercase">The Official</span>
                </div>

                <h1
                    class="text-6xl md:text-8xl lg:text-9xl font-heading font-bold text-transparent bg-clip-text bg-gradient-to-b from-swc-gold via-yellow-500 to-yellow-800 drop-shadow-lg leading-tight pb-2">
                    Memory of SWC 2568
                </h1>

                <div class="h-16 flex items-center justify-center">
                    <p class="text-xl md:text-3xl font-light text-swc-paper/90 italic font-body min-w-[300px]">
                        <span id="typewriter" class="typing-cursor"></span>
                    </p>
                </div>

                <!-- Countdown Timer (Updated Design) -->
                <div class="mt-12 glass-panel inline-block px-10 py-8 rounded-2xl border border-swc-gold/30 bg-swc-dark/30 backdrop-blur-md"
                    data-aos="fade-up" data-aos-delay="200">
                    <p
                        class="text-swc-gold text-xs md:text-sm uppercase tracking-[0.2em] mb-6 border-b border-swc-gold/30 pb-4 font-heading">
                        Countdown</p>
                    <div id="countdown"
                        class="flex flex-wrap justify-center gap-4 md:gap-8 items-baseline min-h-[80px]">
                        <!-- Loading state -->
                        <div class="animate-pulse text-swc-gold text-xl">Loading...</div>
                    </div>
                </div>

                <!-- CTA Buttons (ID Added for targeting) -->
                <div id="home-cta-buttons"
                    class="flex flex-col sm:flex-row justify-center gap-5 mt-12 transition-all duration-500"
                    data-aos="fade-up" data-aos-delay="400">


                </div>
            </div>
        </section>



        <!-- 2. VTR SECTION -->
        <section id="vtr" class="py-20 hidden relative">
            <div class="max-w-6xl mx-auto px-4 sm:px-6">
                <div class="text-center mb-16" data-aos="fade-down">
                    <h2 class="text-4xl font-heading text-swc-gold mb-2">Memories</h2>
                    <div class="h-1 w-24 bg-swc-gold mx-auto rounded-full"></div>
                    <p class="mt-4 text-swc-paper/60 font-light">เรื่องราว ความรัก และหยาดเหงื่อ ตลอด 3 ปีที่ผ่านมา</p>
                </div>
                <div class="glass-panel p-2 rounded-2xl shadow-2xl mb-12 transition-transform hover:scale-[1.01] duration-500"
                    data-aos="zoom-in">
                    <div class="relative w-full pt-[56.25%] rounded-xl overflow-hidden bg-black">
                        <iframe class="absolute top-0 left-0 w-full h-full"
                            src="https://www.youtube.com/embed/dQw4w9WgXcQ?si=X" title="Main VTR" frameborder="0"
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                            allowfullscreen></iframe>
                    </div>
                </div>
                <!-- Additional VTR grid here -->
                <div class="grid md:grid-cols-2 gap-8">
                    <div class="bg-swc-dark/50 border border-swc-green/30 rounded-xl overflow-hidden hover:border-swc-gold/50 transition-all group cursor-pointer"
                        data-aos="fade-right">
                        <div class="relative pt-[56.25%]">
                            <img src="https://placehold.co/600x400/1f5731/fbf3e4?text=Teacher+Interview" alt="Teacher"
                                class="absolute top-0 left-0 w-full h-full object-cover group-hover:scale-110 transition-transform duration-700">
                            <div
                                class="absolute inset-0 bg-black/40 flex items-center justify-center group-hover:bg-black/20 transition-all">
                                <i
                                    class="fas fa-play-circle text-5xl text-swc-gold opacity-80 group-hover:scale-125 transition-transform shadow-lg rounded-full bg-black/50"></i>
                            </div>
                        </div>
                        <div class="p-4">
                            <h4 class="font-heading text-lg text-swc-paper">เสียงจากครูที่ปรึกษา</h4>
                            <p class="text-sm text-gray-400">คำอวยพรและความในใจที่คุณอาจไม่เคยรู้</p>
                        </div>
                    </div>
                    <div class="bg-swc-dark/50 border border-swc-green/30 rounded-xl overflow-hidden hover:border-swc-gold/50 transition-all group cursor-pointer"
                        data-aos="fade-left">
                        <div class="relative pt-[56.25%]">
                            <img src="https://placehold.co/600x400/5f7267/fbf3e4?text=Student+Voice" alt="Student"
                                class="absolute top-0 left-0 w-full h-full object-cover group-hover:scale-110 transition-transform duration-700">
                            <div
                                class="absolute inset-0 bg-black/40 flex items-center justify-center group-hover:bg-black/20 transition-all">
                                <i
                                    class="fas fa-play-circle text-5xl text-swc-gold opacity-80 group-hover:scale-125 transition-transform shadow-lg rounded-full bg-black/50"></i>
                            </div>
                        </div>
                        <div class="p-4">
                            <h4 class="font-heading text-lg text-swc-paper">ความในใจเพื่อนถึงเพื่อน</h4>
                            <p class="text-sm text-gray-400">ขอโทษ ขอบคุณ และลาก่อน</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>



        <!-- 4. GUESTBOOK SECTION -->
        <section id="guestbook" class="py-24 hidden relative overflow-hidden min-h-screen flex flex-col bg-[#e8dcca]">
            <script>console.log('Guestbook component loaded');</script>
            <!-- Background Texture -->
            <div class="absolute inset-0 opacity-40 pointer-events-none"
                style="background-image: url('https://www.transparenttextures.com/patterns/cork-board.png');"></div>

            <div class="max-w-6xl mx-auto px-4 relative z-10 w-full">
                <div class="text-center mb-16" data-aos="fade-down">
                    <div class="inline-block relative">
                        <h2 class="text-5xl md:text-6xl font-heading text-swc-gold drop-shadow-lg mb-2">Memory Wall</h2>
                        <div class="h-1 w-full bg-swc-gold/30 rounded-full"></div>
                        <div class="absolute -top-6 -right-8 text-swc-green transform rotate-12 opacity-80">
                            <i class="fas fa-thumbtack text-3xl"></i>
                        </div>
                    </div>
                    <p class="text-swc-dark/60 mt-6 text-lg font-hand tracking-wide">
                        "ทุกข้อความคือความทรงจำ... ที่เราจะเก็บไว้ตลอดไป"
                    </p>

                    <!-- Manual Load Button -->
                    <button onclick="loadGuestbook(true)"
                        class="mt-8 px-8 py-3 bg-swc-gold text-swc-dark font-heading font-bold rounded-full shadow-lg hover:bg-white hover:scale-105 transition-all group">
                        <i class="fas fa-sync-alt mr-2 group-hover:rotate-180 transition-transform"></i>
                        โหลดข้อความความทรงจำ
                    </button>

                    <!-- Debug Status Box -->
                    <div class="text-center mt-4">
                        <div id="debug-status"
                            class="inline-block px-4 py-2 bg-black/80 text-white text-xs font-mono rounded hidden">
                            Waiting for action...
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-12 gap-12 items-start">
                    <!-- Left Column: Write Message Form -->
                    <div class="lg:col-span-4 sticky top-24" data-aos="fade-right">
                        <div
                            class="bg-[#fbf3e4] text-swc-dark p-1 rounded-lg shadow-[0_10px_40px_rgba(0,0,0,0.3)] transform -rotate-1">
                            <div
                                class="border-2 border-dashed border-swc-dark/20 p-6 rounded-lg h-full relative overflow-hidden">
                                <!-- Tape Effect -->
                                <div
                                    class="absolute -top-3 left-1/2 transform -translate-x-1/2 w-32 h-8 tape-effect rotate-1 z-10">
                                </div>

                                <h3 class="font-heading text-2xl font-bold text-swc-green mb-6 text-center">
                                    <i class="fas fa-pen-fancy mr-2"></i>เขียนถึง
                                </h3>

                                <form id="guestbook-form" onsubmit="handleGuestbookSubmit(event)" class="space-y-5">
                                    <div class="space-y-1">
                                        <label
                                            class="text-xs font-bold text-swc-dark/50 uppercase tracking-wider ml-1">From</label>
                                        <input type="text" id="gb-name" placeholder="ชื่อของคุณ..."
                                            class="w-full bg-white/50 border-b-2 border-swc-dark/10 focus:border-swc-gold px-3 py-2 text-lg font-hand text-swc-dark placeholder-swc-dark/30 outline-none transition-colors"
                                            required>
                                    </div>

                                    <div class="space-y-1">
                                        <label
                                            class="text-xs font-bold text-swc-dark/50 uppercase tracking-wider ml-1">Role</label>
                                        <div class="relative">
                                            <select id="gb-role"
                                                class="w-full bg-white/50 border-b-2 border-swc-dark/10 focus:border-swc-gold px-3 py-2 text-base font-body text-swc-dark outline-none transition-colors appearance-none cursor-pointer">
                                                <option value="friend">เพื่อน (Friend)</option>
                                                <option value="junior">รุ่นน้อง (Junior)</option>
                                                <option value="teacher">คุณครู (Teacher)</option>
                                                <option value="secret">ผู้หวังดี (Secret)</option>
                                            </select>
                                            <i
                                                class="fas fa-chevron-down absolute right-3 top-3 text-swc-dark/30 pointer-events-none"></i>
                                        </div>
                                    </div>

                                    <div class="space-y-1 pt-2">
                                        <label
                                            class="text-xs font-bold text-swc-dark/50 uppercase tracking-wider ml-1">Message</label>
                                        <textarea id="gb-message" rows="5" placeholder="อยากบอกอะไร..."
                                            class="w-full bg-white/50 border border-swc-dark/10 rounded-lg p-4 text-lg font-hand text-swc-dark placeholder-swc-dark/30 focus:border-swc-gold outline-none transition-all resize-none leading-relaxed"
                                            style="background-image: linear-gradient(transparent, transparent 29px, rgba(0,0,0,0.05) 30px); background-size: 100% 30px; line-height: 30px;"
                                            required></textarea>
                                    </div>

                                    <button type="submit"
                                        class="w-full bg-swc-dark text-swc-gold font-heading py-3 rounded-lg hover:bg-swc-green transition-all shadow-lg flex items-center justify-center gap-2 group mt-4">
                                        <span>แปะข้อความ</span>
                                        <i
                                            class="fas fa-paper-plane group-hover:translate-x-1 transition-transform"></i>
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>

                    <!-- Right Column: Message Wall -->
                    <div class="lg:col-span-8">
                        <div id="guestbook-list" class="grid grid-cols-1 md:grid-cols-2 gap-6 pb-20">
                            <!-- Empty State (Initially Empty until loaded) -->
                            <div class="col-span-full flex flex-col items-center justify-center py-20 text-swc-dark/50">
                                <i class="fas fa-book-open text-4xl mb-4 text-swc-gold"></i>
                                <p class="font-heading">กดปุ่ม "โหลดข้อความ" เพื่อดูความทรงจำ</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <style>
                /* Guestbook Specific Styles */
                #gb-message::-webkit-scrollbar {
                    width: 8px;
                }

                #gb-message::-webkit-scrollbar-track {
                    background: rgba(0, 0, 0, 0.05);
                }

                #gb-message::-webkit-scrollbar-thumb {
                    background: #d4af37;
                    border-radius: 4px;
                }

                .tape-effect {
                    background-color: rgba(255, 255, 255, 0.3);
                    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
                    backdrop-filter: blur(2px);
                    border-left: 1px dashed rgba(255, 255, 255, 0.3);
                    border-right: 1px dashed rgba(255, 255, 255, 0.3);
                }

                .pin-head {
                    background: radial-gradient(circle at 30% 30%, #ff6b6b, #c0392b);
                    box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.3);
                }

                .paper-texture {
                    background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.05'/%3E%3C/svg%3E");
                }
            </style>
            <script>
                // Guestbook Logic
                document.addEventListener('DOMContentLoaded', () => {
                    // Removed auto-load
                    // if (typeof loadGuestbook === 'function') {
                    //     loadGuestbook();
                    //     setInterval(() => loadGuestbook(true), 10000);
                    // }
                });

                function timeAgo(date) {
                    const seconds = Math.floor((new Date() - date) / 1000);
                    let interval = seconds / 31536000;
                    if (interval > 1) return Math.floor(interval) + " ปีที่แล้ว";
                    interval = seconds / 2592000;
                    if (interval > 1) return Math.floor(interval) + " เดือนที่แล้ว";
                    interval = seconds / 86400;
                    if (interval > 1) return Math.floor(interval) + " วันที่แล้ว";
                    interval = seconds / 3600;
                    if (interval > 1) return Math.floor(interval) + " ชั่วโมงที่แล้ว";
                    interval = seconds / 60;
                    if (interval > 1) return Math.floor(interval) + " นาทีที่แล้ว";
                    return "เมื่อสักครู่";
                }

                function loadGuestbook(showLoading = true) {
                    const list = document.getElementById('guestbook-list');
                    const debugEl = document.getElementById('debug-status');
                    if (!list) return;

                    if (showLoading) {
                        list.innerHTML = `
                            <div class="col-span-full flex flex-col items-center justify-center py-20 text-swc-gold/50">
                                <i class="fas fa-circle-notch fa-spin text-4xl mb-4"></i>
                                <p class="font-heading">กำลังรวบรวมความทรงจำ...</p>
                            </div>`;
                    }

                    if (typeof google !== 'undefined' && google.script) {
                        debugEl.classList.remove('hidden');
                        debugEl.textContent = "Mode: Web App (google.script.run)...";

                        google.script.run
                            .withSuccessHandler(data => {
                                debugEl.textContent = "Success: Received " + (data ? data.length : 0) + " items";
                                debugEl.classList.add('bg-green-800');
                                renderGuestbook(data);
                            })
                            .withFailureHandler(error => {
                                console.error('Error:', error);
                                debugEl.textContent = "Error: " + error.message;
                                debugEl.classList.add('bg-red-800');
                                list.innerHTML = '<div class="col-span-full text-center text-red-400">โหลดข้อมูลไม่สำเร็จ: ' + error.message + '</div>';
                            })
                            .getGuestbookData();
                    } else {
                        // Local Development Mode
                        debugEl.classList.remove('hidden');
                        debugEl.textContent = "Mode: Local Fetch...";

                        if (typeof GAS_WEB_APP_URL === 'undefined' || !GAS_WEB_APP_URL) {
                            debugEl.textContent = "Mode: Local Mock (No URL)";
                            // ... mock data logic ...
                            const mockData = [
                                { name: "Local User", role: "friend", message: "นี่คือข้อมูลจำลอง (Mock Data) สำหรับการทดสอบ Local", timestamp: new Date() },
                                { name: "Dev Mode", role: "teacher", message: "ถ้าต้องการดึงข้อมูลจริง ให้ใส่ URL ของ Web App ในตัวแปร GAS_WEB_APP_URL", timestamp: new Date(Date.now() - 3600000) }
                            ];
                            renderGuestbook(mockData);
                            return;
                        }

                        fetch(`${GAS_WEB_APP_URL}?action=getGuestbook`)
                            .then(response => {
                                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                                return response.text().then(text => {
                                    try {
                                        return JSON.parse(text);
                                    } catch (e) {
                                        throw new Error('Invalid JSON: ' + text.substring(0, 50));
                                    }
                                });
                            })
                            .then(data => {
                                debugEl.textContent = "Success: Received " + (data ? data.length : 0) + " items";
                                debugEl.classList.add('bg-green-800');
                                renderGuestbook(data);
                            })
                            .catch(error => {
                                debugEl.textContent = "Error: " + error.message;
                                debugEl.classList.add('bg-red-800');
                                list.innerHTML = `<div class="col-span-full text-center text-red-400">
                                    <p class="font-bold">โหลดข้อมูลไม่สำเร็จ</p>
                                    <p class="text-xs mt-1 opacity-70">${error.message}</p>
                                </div>`;
                            });
                    }
                }

                function renderGuestbook(data) {
                    const list = document.getElementById('guestbook-list');
                    if (!list) return;

                    if (!data || data.length === 0) {
                        list.innerHTML = `
                            <div class="col-span-full text-center py-12 opacity-50">
                                <i class="fas fa-pen-alt text-4xl mb-4 text-swc-gold"></i>
                                <p class="text-swc-dark/50">ยังไม่มีข้อความ... มาเขียนคนแรกกันเถอะ!</p>
                            </div>`;
                        return;
                    }
                    list.innerHTML = '';
                    data.forEach((item, index) => {
                        const div = createGuestbookItem(item.name, item.role, item.message, new Date(item.timestamp), index);
                        list.appendChild(div);
                    });
                }

                function createGuestbookItem(name, role, message, timestamp, index = 0) {
                    const div = document.createElement('div');
                    const rotate = (Math.random() * 4 - 2).toFixed(1);
                    div.className = "bg-[#fbf3e4] text-swc-dark p-6 rounded-sm shadow-md relative transform transition-all duration-300 hover:scale-105 hover:shadow-xl hover:z-10 group cursor-default break-inside-avoid paper-texture";
                    div.style.transform = `rotate(${rotate}deg)`;
                    div.setAttribute('data-aos', 'fade-up');
                    div.setAttribute('data-aos-delay', (index % 5) * 100);

                    let badgeColor = "bg-swc-dark text-swc-gold";
                    if (role === 'teacher') badgeColor = "bg-swc-gold text-swc-dark";
                    if (role === 'junior') badgeColor = "bg-swc-green text-white";
                    if (role === 'secret') badgeColor = "bg-pink-500 text-white";

                    div.innerHTML = `
                        <div class="absolute -top-3 left-1/2 transform -translate-x-1/2 w-4 h-4 rounded-full pin-head z-10 border border-red-800 opacity-90"></div>
                        <div class="absolute -top-3 left-1/2 transform -translate-x-1/2 w-1 h-2 bg-black/20 blur-[1px]"></div>
                        <div class="relative z-0 h-full rounded-sm">
                            <div class="flex justify-between items-start mb-4">
                                <span class="text-[10px] font-bold uppercase tracking-widest text-swc-dark/40">${timeAgo(timestamp)}</span>
                                <span class="${badgeColor} text-[10px] px-2 py-0.5 rounded-full font-bold uppercase tracking-wide shadow-sm">${role}</span>
                            </div>
                            <p class="font-hand text-xl md:text-2xl font-bold leading-relaxed text-swc-dark/90 mb-6 min-h-[60px]">"${message}"</p>
                            <div class="flex items-center gap-3 border-t-2 border-dashed border-swc-dark/10 pt-3 mt-auto">
                                <div class="w-8 h-8 rounded-full bg-swc-dark/10 flex items-center justify-center text-swc-dark font-heading font-bold text-sm">${name.charAt(0).toUpperCase()}</div>
                                <div class="flex-1 min-w-0"><p class="font-heading font-bold text-sm truncate text-swc-green">${name}</p></div>
                                <i class="fas fa-heart text-swc-dark/10 group-hover:text-red-500 transition-colors duration-300"></i>
                            </div>
                        </div>
                    `;
                    return div;
                }

                function handleGuestbookSubmit(e) {
                    e.preventDefault();
                    const btn = e.target.querySelector('button[type="submit"]');
                    const originalBtnContent = btn.innerHTML;
                    btn.disabled = true;
                    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> กำลังแปะ...';

                    const name = document.getElementById('gb-name').value;
                    const roleSelect = document.getElementById('gb-role');
                    const role = roleSelect.options[roleSelect.selectedIndex].value;
                    const message = document.getElementById('gb-message').value;
                    const payload = { name, role, message };

                    if (typeof google !== 'undefined' && google.script) {
                        google.script.run.withSuccessHandler(onSuccess).withFailureHandler(onFailure).saveGuestbook(payload);
                    } else {
                        if (typeof GAS_WEB_APP_URL === 'undefined' || !GAS_WEB_APP_URL) {
                            // Local Mock Submit
                            setTimeout(() => { onSuccess(); }, 1000);
                            return;
                        }
                        fetch(GAS_WEB_APP_URL, { method: 'POST', body: JSON.stringify(payload) })
                            .then(response => response.json())
                            .then(result => { if (result.result === 'success') onSuccess(); else onFailure(result.error); })
                            .catch(onFailure);
                    }

                    function onSuccess() {
                        const list = document.getElementById('guestbook-list');
                        if (list.querySelector('.fa-pen-alt')) list.innerHTML = '';
                        const div = createGuestbookItem(name, role, message, new Date());
                        div.style.opacity = '0';
                        div.style.transform = 'scale(0.8) rotate(0deg)';
                        list.prepend(div);
                        void div.offsetWidth;
                        div.style.transition = 'all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
                        div.style.opacity = '1';
                        div.style.transform = `scale(1) rotate(${Math.random() * 4 - 2}deg)`;
                        document.getElementById('guestbook-form').reset();
                        btn.disabled = false;
                        btn.innerHTML = '<i class="fas fa-check"></i> เรียบร้อย!';
                        setTimeout(() => btn.innerHTML = originalBtnContent, 2000);
                    }

                    function onFailure(error) {
                        console.error('Error:', error);
                        alert('เกิดข้อผิดพลาด: ' + error);
                        btn.disabled = false;
                        btn.innerHTML = originalBtnContent;
                    }
                }
            </script>
        </section>

        <!-- 5. LOGIN / PRIVATE SECTION -->
        <section id="letters" class="py-24 hidden min-h-[80vh] flex items-center">
            <div class="max-w-md mx-auto px-4 w-full">
                <div id="login-container"
                    class="glass-panel p-10 rounded-2xl shadow-[0_0_50px_rgba(212,175,55,0.15)] text-center relative overflow-hidden"
                    data-aos="flip-left">
                    <div class="absolute -top-10 -left-10 w-32 h-32 bg-swc-gold/10 rounded-full blur-2xl"></div>
                    <div class="absolute -bottom-10 -right-10 w-32 h-32 bg-swc-green/10 rounded-full blur-2xl"></div>
                    <div
                        class="w-24 h-24 bg-gradient-to-br from-swc-gold to-yellow-600 rounded-full flex items-center justify-center mx-auto mb-8 shadow-lg ring-4 ring-swc-dark">
                        <i class="fas fa-lock text-swc-dark text-4xl"></i>
                    </div>
                    <h2 class="text-3xl font-heading text-swc-gold mb-2">พื้นที่ส่วนตัว</h2>
                    <p class="text-sm text-gray-400 mb-8">กรอกรหัสประจำตัวนักเรียนเพื่อเปิดจดหมาย</p>
                    <form onsubmit="handleLogin(event)" class="space-y-6 relative z-10">
                        <div class="relative">
                            <input type="password" id="student-id" placeholder="•••••"
                                class="w-full bg-swc-dark border-2 border-swc-gold/30 rounded-xl px-4 py-4 text-center text-2xl tracking-[0.5em] text-swc-gold placeholder-gray-700 focus:border-swc-gold focus:ring-0 focus:outline-none transition-all font-heading">
                        </div>
                        <p id="login-error" class="text-red-400 text-sm hidden bg-red-900/20 py-2 rounded"><i
                                class="fas fa-exclamation-circle mr-1"></i> รหัสไม่ถูกต้อง</p>
                        <button type="submit"
                            class="w-full bg-swc-gold text-swc-dark font-bold py-4 rounded-xl hover:bg-white transition-colors shadow-[0_0_20px_rgba(212,175,55,0.2)] uppercase tracking-wider text-sm">
                            เข้าสู่ระบบ
                        </button>
                    </form>
                </div>

                <div id="private-content" class="hidden space-y-8">
                    <div class="bg-[#fbf3e4] text-swc-dark p-8 md:p-12 rounded-lg shadow-2xl relative transform rotate-1"
                        data-aos="zoom-in">
                        <div
                            class="absolute top-6 right-6 border-2 border-red-800 text-red-800 text-xs font-bold px-2 py-1 rounded transform rotate-[-12deg] opacity-70">
                            TOP SECRET</div>
                        <div class="border-b-2 border-swc-dark/10 pb-6 mb-6 flex items-center gap-4">
                            <div class="w-16 h-16 rounded-full bg-gray-300 overflow-hidden border-2 border-swc-gold">
                                <img src="https://placehold.co/100x100" alt="Profile"
                                    class="w-full h-full object-cover">
                            </div>
                            <div>
                                <h3 id="student-name-display" class="text-2xl font-heading text-swc-green font-bold">
                                    Loading...</h3>
                                <p id="student-id-display" class="text-sm text-gray-500">รหัสนักเรียน: ...</p>
                            </div>
                        </div>

                        <div id="letter-content" class="prose font-body leading-loose text-gray-800 text-lg">
                            <!-- Letter content will be injected here -->
                        </div>

                        <p class="text-right font-hand font-bold mt-12 text-2xl text-swc-green">- LUNOVA -</p>

                        <div class="mt-10 pt-8 border-t-2 border-dashed border-gray-300">
                            <p class="font-heading text-swc-dark mb-4 flex items-center gap-2"><i
                                    class="fas fa-film text-swc-gold"></i> คลิปพิเศษสำหรับเธอ</p>
                            <div id="private-vtr-container"
                                class="bg-black rounded-lg overflow-hidden relative pt-[56.25%] shadow-inner">
                                <div class="absolute inset-0 flex items-center justify-center text-white/50 flex-col">
                                    <i class="fas fa-lock text-3xl mb-2"></i>
                                    <span>NOT SINGLE</span>
                                </div>
                            </div>
                        </div>

                        <button onclick="logout()"
                            class="mt-8 w-full text-center text-sm text-gray-400 hover:text-red-600 transition-colors">
                            <i class="fas fa-sign-out-alt mr-1"></i> ปิดจดหมายและออกจากระบบ
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="bg-black border-t border-swc-gold/20 pt-12 pb-8 text-center">
            <div class="max-w-7xl mx-auto px-4">
                <div
                    class="w-12 h-12 mx-auto mb-6 bg-swc-dark border border-swc-gold rounded-full flex items-center justify-center text-swc-gold">
                    <a href="https://www.facebook.com/profile.php?id=100063973063508">
                        <i class="fas fa-graduation-cap"></i>
                    </a>
                </div>
                <div class="flex justify-center space-x-8 mb-8">
                    <a href="https://www.youtube.com/@ItsKuroLuck" target="_blank" rel="noopener noreferrer"
                        class="text-swc-gold/60 hover:text-swc-gold transition transform hover:-translate-y-1"><i
                            class="fab fa-youtube text-2xl"></i></a>
                    <a href="https://www.tiktok.com/@lunovadream?_r=1&_t=ZS-91j54pQKznY" target="_blank"
                        rel="noopener noreferrer"
                        class="text-swc-gold/60 hover:text-swc-gold transition transform hover:-translate-y-1"><i
                            class="fab fa-tiktok text-2xl"></i></a>
                    <a href="https://www.facebook.com/theeradet.detsungnoen/" target="_blank" rel="noopener noreferrer"
                        class="text-swc-gold/60 hover:text-swc-gold transition transform hover:-translate-y-1"><i
                            class="fab fa-facebook text-2xl"></i></a>
                    <a href="https://www.instagram.com/_thesilentwatcher_27/" target="_blank" rel="noopener noreferrer"
                        class="text-swc-gold/60 hover:text-swc-gold transition transform hover:-translate-y-1"><i
                            class="fab fa-instagram text-2xl"></i></a>
                </div>
                <p class="text-swc-gold font-heading text-xl tracking-wide">Memory of SWC 2568</p>
                <p class="text-gray-600 text-sm mt-4 font-light">
                    Created by ธีรเดช เดชสูงเนิน
                    <br> สภานักเรียนโรงเรียนศรีวิชัยวิทยา
                </p>
                <p class="text-gray-800 text-xs mt-2">© 2025 All Rights Reserved.</p>
            </div>
        </footer>

    </main>

    <!-- 4. Scripts -->
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            AOS.init({
                duration: 1000,
                once: true,
                offset: 50,
                easing: 'ease-out-cubic'
            });

            createFireflies();
            typeWriter();
            startCountdown();

            window.addEventListener('scroll', () => {
                const header = document.getElementById('main-header');
                const backToTop = document.getElementById('back-to-top');

                if (window.scrollY > 50) {
                    header.classList.add('shadow-xl', 'py-0');
                    backToTop.classList.remove('translate-y-20', 'opacity-0');
                } else {
                    header.classList.remove('shadow-xl');
                    backToTop.classList.add('translate-y-20', 'opacity-0');
                }
            });
        });

        function createFireflies() {
            const container = document.getElementById('fireflies-container');
            const count = 30;

            for (let i = 0; i < count; i++) {
                const firefly = document.createElement('div');
                firefly.classList.add('firefly');
                const left = Math.random() * 100;
                const animDuration = 3 + Math.random() * 5;
                const animDelay = Math.random() * 5;

                firefly.style.left = `${left}%`;
                firefly.style.animationDuration = `${animDuration}s`;
                firefly.style.animationDelay = `${animDelay}s`;

                container.appendChild(firefly);
            }
        }

        function navigateTo(sectionId, event) {
            if (event) event.preventDefault();

            // Lock VTR, Gallery, and Login if countdown is not finished
            if ((sectionId === 'vtr' || sectionId === 'gallery' || sectionId === 'letters') && !isCountdownFinished) {
                alert('ใจเย็นๆ นะวัยรุ่น! ส่วนนี้จะเปิดให้เข้าชมเมื่อเวลาหมดลงครับ');
                return;
            }

            document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('nav-active'));
            const activeLink = document.querySelector(`a[href="#${sectionId}"]`);
            if (activeLink) activeLink.classList.add('nav-active');

            document.querySelectorAll('main > section').forEach(sec => {
                sec.classList.add('hidden');
                sec.classList.remove('section-fade-in');
            });
            const target = document.getElementById(sectionId);
            target.classList.remove('hidden');
            // Trigger reflow to ensure animation plays
            void target.offsetWidth;
            target.classList.add('section-fade-in');

            setTimeout(() => AOS.refresh(), 100);
            window.scrollTo({ top: 0, behavior: 'smooth' });
            document.getElementById('mobile-menu').classList.add('hidden');
        }

        function toggleMobileMenu() {
            const menu = document.getElementById('mobile-menu');
            menu.classList.toggle('hidden');
        }

        function mobileNav(sectionId) {
            navigateTo(sectionId);
        }

        function openLightbox(element) {
            const img = element.querySelector('img');
            const lightbox = document.getElementById('lightbox');
            const lightboxImg = document.getElementById('lightbox-img');

            lightboxImg.src = img.src;
            lightbox.classList.remove('hidden');
            setTimeout(() => {
                lightboxImg.classList.remove('scale-90');
                lightboxImg.classList.add('scale-100');
            }, 10);
        }

        function closeLightbox() {
            const lightbox = document.getElementById('lightbox');
            const lightboxImg = document.getElementById('lightbox-img');

            lightboxImg.classList.remove('scale-100');
            lightboxImg.classList.add('scale-90');
            setTimeout(() => {
                lightbox.classList.add('hidden');
            }, 200);
        }

        const texts = ["ความทรงจำ... ที่ไม่มีวันลืม", "เพื่อน... ที่จะอยู่ในใจตลอดไป", "ขอให้โชคดี... บนเส้นทางใหม่"];
        let textIndex = 0;
        let charIndex = 0;
        let isDeleting = false;
        const typeSpeed = 80;
        const deleteSpeed = 40;

        const pause = 2000;
        let isCountdownFinished = false;

        function typeWriter() {
            const currentText = texts[textIndex];
            const element = document.getElementById('typewriter');

            if (isDeleting) {
                element.textContent = currentText.substring(0, charIndex - 1);
                charIndex--;
            } else {
                element.textContent = currentText.substring(0, charIndex + 1);
                charIndex++;
            }

            let typeDelay = isDeleting ? deleteSpeed : typeSpeed;

            if (!isDeleting && charIndex === currentText.length) {
                typeDelay = pause;
                isDeleting = true;
            } else if (isDeleting && charIndex === 0) {
                isDeleting = false;
                textIndex = (textIndex + 1) % texts.length;
                typeDelay = 500;
            }

            setTimeout(typeWriter, typeDelay);
        }

        function startCountdown() {
            // -------------------------------------------------
            // [CONFIG] ตั้งค่าวันที่จบการศึกษาตรงนี้
            // รูปแบบ: YYYY-MM-DDTHH:mm:ss
            // -------------------------------------------------
            let gradDate = new Date("2026-03-31T00:00:00").getTime();

            // -------------------------------------------------
            // [TEST MODE] ปลดคอมเมนต์บรรทัดล่างนี้ เพื่อทดสอบเวลานับถอยหลัง 5 วินาทีจากปัจจุบัน
            gradDate = new Date().getTime() + 5000;
            // -------------------------------------------------

            const interval = setInterval(() => {
                const now = new Date().getTime();
                const distance = gradDate - now;

                const el = document.getElementById("countdown");

                if (distance < 0) {
                    clearInterval(interval);
                    isCountdownFinished = true;
                    el.innerHTML = `
                        <div class='text-4xl md:text-6xl font-heading font-bold text-swc-gold animate-bounce drop-shadow-lg tracking-wide'>
                            CONGRATULATIONS!
                        </div>
                    `;

                    // Hide buttons and Show Video
                    const actions = document.getElementById('home-cta-buttons');
                    if (actions) actions.classList.add('hidden');

                    // Unlock Nav Links
                    const vtrNav = document.getElementById('nav-vtr');
                    const galleryNav = document.getElementById('nav-gallery');
                    const lettersNav = document.getElementById('nav-letters');
                    if (vtrNav) {
                        vtrNav.classList.remove('nav-locked');
                        vtrNav.classList.add('nav-unlocked-pulse');
                        vtrNav.innerHTML = '<i class="fas fa-lock-open mr-1"></i> VTR';
                    }
                    if (galleryNav) {
                        galleryNav.classList.remove('nav-locked');
                        galleryNav.classList.add('nav-unlocked-pulse');
                        galleryNav.innerHTML = '<i class="fas fa-lock-open mr-1"></i> Gallery';
                    }

                    if (lettersNav) {
                        lettersNav.classList.remove('nav-locked'); // เอากุญแจล็อกออก
                        lettersNav.classList.add('nav-unlocked-pulse'); // ใส่ Effect กระพริบ
                        lettersNav.innerHTML = '<i class="fas fa-lock-open mr-1"></i> Login'; // (Option) เปลี่ยนข้อความ
                    }

                    if (!document.getElementById('graduation-video-container')) {
                        const videoDiv = document.createElement('div');
                        videoDiv.id = 'graduation-video-container';
                        videoDiv.className = 'mt-8 w-full max-w-3xl mx-auto animate-fade-in';
                        videoDiv.innerHTML = `
                            <div class="relative pt-[56.25%] rounded-xl overflow-hidden shadow-[0_0_30px_rgba(212,175,55,0.3)] border border-swc-gold/30">
                                <iframe class="absolute top-0 left-0 w-full h-full" src="https://www.youtube.com/embed/dQw4w9WgXcQ?autoplay=1" title="Graduation VTR" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                            </div>
                            <br><p>คลิกที่ปุ่มเล่นหากวิดีโอไม่เริ่มอัตโนมัติ</p>

                        `;
                        el.parentElement.insertAdjacentElement('afterend', videoDiv);
                    }
                    return;
                }

                const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);

                el.innerHTML = `
                    <div class="text-center"><div class="text-4xl md:text-6xl font-heading font-bold text-swc-paper">${days}</div><div class="text-[10px] text-swc-gold tracking-widest">DAYS</div></div>
                    <div class="text-4xl md:text-6xl font-heading text-swc-gold/30">:</div>
                    <div class="text-center"><div class="text-4xl md:text-6xl font-heading font-bold text-swc-paper">${hours}</div><div class="text-[10px] text-swc-gold tracking-widest">HRS</div></div>
                    <div class="text-4xl md:text-6xl font-heading text-swc-gold/30">:</div>
                    <div class="text-center"><div class="text-4xl md:text-6xl font-heading font-bold text-swc-paper">${minutes}</div><div class="text-[10px] text-swc-gold tracking-widest">MIN</div></div>
                    <div class="text-4xl md:text-6xl font-heading text-swc-gold/30">:</div>
                    <div class="text-center"><div class="text-4xl md:text-6xl font-heading font-bold text-swc-gold">${seconds}</div><div class="text-[10px] text-swc-gold tracking-widest">SEC</div></div>
                `;
            }, 1000);
        }

        // -------------------------------------------------
        // [CONFIG] Google Apps Script Web App URL
        // -------------------------------------------------
        // ใส่ URL ของ Web App ที่ได้จากการ Deploy ที่นี่ เพื่อให้ทำงานได้บนเครื่องตัวเอง (Localhost)
        // const GAS_WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbzQZY4wkSFAwMxk-oj0HC5X7Fmg9-w4Q3QOB0BVz4Kx-j69-cywUOZejxA9B4togLiqiA/exec'; // ตัวอย่าง: 'https://script.google.com/macros/s/AKfycbx.../exec'
        // -------------------------------------------------



        function handleLogin(event) {
            event.preventDefault();
            const studentIdInput = document.getElementById('student-id');
            const studentId = studentIdInput.value.trim();
            const errorElement = document.getElementById('login-error');
            const loginBtn = event.target.querySelector('button[type="submit"]');

            // Reset error
            errorElement.classList.add('hidden');

            if (!studentId) {
                showLoginError('กรุณากรอกรหัสประจำตัวนักเรียน');
                return;
            }

            // Show loading state
            const originalBtnText = loginBtn.innerHTML;
            loginBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> กำลังตรวจสอบ...';
            loginBtn.disabled = true;

            // Call Google Apps Script
            if (typeof google !== 'undefined' && google.script) {
                google.script.run
                    .withSuccessHandler((response) => {
                        loginBtn.innerHTML = originalBtnText;
                        loginBtn.disabled = false;
                        onLoginSuccess(response);
                    })
                    .withFailureHandler((error) => {
                        loginBtn.innerHTML = originalBtnText;
                        loginBtn.disabled = false;
                        console.error('Login failed:', error);
                        showLoginError('เกิดข้อผิดพลาดในการเชื่อมต่อระบบ');
                    })
                    .getPrivateContent(studentId);
            } else {
                // Local Dev Mock
                console.warn('Running in local mode. Using mock data.');
                setTimeout(() => {
                    loginBtn.innerHTML = originalBtnText;
                    loginBtn.disabled = false;
                    if (studentId === '12345') {
                        onLoginSuccess({
                            status: 'success',
                            data: {
                                name: 'ทุกคนที่หลงเข้ามา',
                                class: 'ALL',
                                privateVideoUrl: 'NOT SINGLE',
                                privateLetterText: 'สวัสดีทุกคน...\nก่อนงานนี้จะเกิดขึ้น…มีหลายอย่างที่ผมอยากให้ทุกคนได้รับ แต่พูดออกมาตรง ๆ ไม่ได้\nเลยอยากใช้โปรเจกต์นี้แทนคำพูดทั้งหมดของผม ผมอยากให้วันสุดท้ายของพวกเรา…ไม่ใช่แค่วันจบ แต่เป็นวันที่ทุกคนได้รู้ว่า ตลอดเวลาที่อยู่ที่นี่ ทุกคนมี ‘ความหมาย’ จริง ๆ ถ้าวันไหนเหนื่อย วันไหนเจอเรื่องที่ทำให้รู้สึกว่าไร้ค่า ลองกลับมาอ่านข้อความพวกนี้อีกครั้ง แล้วจะเห็นว่า… เคยมีวันหนึ่งที่พวกเราถูก ‘รัก’ มากจริง ๆ \nขอบคุณที่ยอมให้ผมสร้างของขวัญชิ้นนี้เพื่อช่วยบันทึกเรื่องราวของพวกคุณ\nและหวังว่าในอนาคต… เมื่อพวกคุณคิดถึงกัน\nพวกเราทีมงานจะเป็นที่ที่คุณได้กลับมาเจอกันอีกครั้งครับ'
                            }
                        });
                    } else {
                        onLoginSuccess({ status: 'not_found', message: 'ไม่พบเลขประจำตัวนักเรียนนี้ในระบบ' });
                    }
                }, 1000);
            }
        }

        function onLoginSuccess(response) {
            if (response.status === 'success') {
                const data = response.data;

                // Populate Data
                document.getElementById('student-name-display').textContent = data.name;
                document.getElementById('student-id-display').textContent = 'รหัสนักเรียน: ' + document.getElementById('student-id').value;

                // Format letter text (handle newlines)
                const letterHtml = data.privateLetterText.split('\n').map(line => `<p class="mb-4 text-justify indent-8">${line}</p>`).join('');
                document.getElementById('letter-content').innerHTML = letterHtml;

                // Update VTR if available
                const vtrContainer = document.getElementById('private-vtr-container');
                if (data.teacherVtrLink) {
                    let embedUrl = data.teacherVtrLink;
                    // Convert standard YouTube URL to Embed URL if necessary
                    if (embedUrl.includes('watch?v=')) {
                        embedUrl = embedUrl.replace('watch?v=', 'embed/');
                    } else if (embedUrl.includes('youtu.be/')) {
                        embedUrl = embedUrl.replace('youtu.be/', 'www.youtube.com/embed/');
                    }

                    vtrContainer.innerHTML = `
                        <iframe class="absolute top-0 left-0 w-full h-full" 
                            src="${embedUrl}" 
                            title="Private VTR" frameborder="0" 
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                            allowfullscreen></iframe>
                    `;
                } else {
                    vtrContainer.innerHTML = `
                        <div class="absolute inset-0 flex items-center justify-center text-white/50 flex-col">
                            <i class="fas fa-video-slash text-3xl mb-2"></i>
                            <span>ไม่มีคลิปวิดีโอสำหรับคุณ</span>
                        </div>
                    `;
                }

                // Transition UI
                const container = document.getElementById('login-container');
                const content = document.getElementById('private-content');

                container.style.transition = 'all 0.5s ease';
                container.style.transform = "scale(0.9)";
                container.style.opacity = "0";

                setTimeout(() => {
                    container.classList.add('hidden');
                    content.classList.remove('hidden');
                    AOS.refresh();
                }, 500);

            } else {
                showLoginError(response.message || 'รหัสไม่ถูกต้อง');
            }
        }

        function showLoginError(message) {
            const errorElement = document.getElementById('login-error');
            const container = document.getElementById('login-container');

            errorElement.innerHTML = `<i class="fas fa-exclamation-circle mr-1"></i> ${message}`;
            errorElement.classList.remove('hidden');

            container.classList.add('animate-pulse');
            setTimeout(() => container.classList.remove('animate-pulse'), 500);
        }

        function logout() {
            document.getElementById('student-id').value = '';
            const container = document.getElementById('login-container');
            const content = document.getElementById('private-content');

            content.classList.add('hidden');
            container.classList.remove('hidden');

            setTimeout(() => {
                container.style.transform = "scale(1)";
                container.style.opacity = "1";
            }, 50);

            document.getElementById('login-error').classList.add('hidden');
        }



        var player;
        function onYouTubeIframeAPIReady() {
            player = new YT.Player('youtube-audio', {
                height: '0',
                width: '0',
                videoId: '5Ggnzs2hP3s',
                playerVars: {
                    'autoplay': 0,
                    'controls': 0,
                    'loop': 1,
                    'playlist': '5Ggnzs2hP3s'
                },
                events: {
                    'onReady': onPlayerReady
                }
            });
        }

        function onPlayerReady(event) {
        }

        function toggleMusic() {
            if (!player) return;

            const icon = document.getElementById('music-icon');
            const btn = document.getElementById('music-btn');

            const state = player.getPlayerState();

            if (state !== 1) {
                player.playVideo();
                icon.classList.remove('fa-play');
                icon.classList.add('fa-pause');
                btn.classList.add('animate-spin-slow', 'border-white');
            } else {
                player.pauseVideo();
                icon.classList.remove('fa-pause');
                icon.classList.add('fa-play');
                btn.classList.remove('animate-spin-slow', 'border-white');
            }
        }
    </script>
</body>

</html>
